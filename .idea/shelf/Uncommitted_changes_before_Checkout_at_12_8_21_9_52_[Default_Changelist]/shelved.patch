Index: src/Security/LoginAuthenticator.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\n\nnamespace App\\Security;\n\nuse App\\Entity\\User;\nuse Doctrine\\ORM\\EntityManagerInterface;\nuse Symfony\\Component\\HttpFoundation\\RedirectResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Session\\Flash\\FlashBagInterface;\nuse Symfony\\Component\\Routing\\Generator\\UrlGeneratorInterface;\nuse Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;\nuse Symfony\\Component\\Security\\Core\\Encoder\\UserPasswordEncoderInterface;\nuse Symfony\\Component\\Security\\Core\\Exception\\CustomUserMessageAuthenticationException;\nuse Symfony\\Component\\Security\\Core\\Exception\\InvalidCsrfTokenException;\nuse Symfony\\Component\\Security\\Core\\Security;\nuse Symfony\\Component\\Security\\Core\\User\\UserInterface;\nuse Symfony\\Component\\Security\\Core\\User\\UserProviderInterface;\nuse Symfony\\Component\\Security\\Csrf\\CsrfToken;\nuse Symfony\\Component\\Security\\Csrf\\CsrfTokenManagerInterface;\nuse Symfony\\Component\\Security\\Guard\\Authenticator\\AbstractFormLoginAuthenticator;\nuse Symfony\\Component\\Security\\Guard\\PasswordAuthenticatedInterface;\nuse Symfony\\Component\\Security\\Http\\Util\\TargetPathTrait;\nuse App\\Domain\\Services\\FindGameSessionMilestoneService;\n\n\nclass LoginAuthenticator extends AbstractFormLoginAuthenticator implements PasswordAuthenticatedInterface\n{\n    use TargetPathTrait;\n\n    public const LOGIN_ROUTE = 'app_login';\n    public const ADMIN_ROUTE = 'admin_menu';\n    private $entityManager;\n    private $urlGenerator;\n    private $csrfTokenManager;\n    private $passwordEncoder;\n    private $flashBag;\n    /**\n     * @var User|object|null\n     */\n    private $user;\n\n    public function __construct(EntityManagerInterface $entityManager, UrlGeneratorInterface $urlGenerator, CsrfTokenManagerInterface $csrfTokenManager, UserPasswordEncoderInterface $passwordEncoder, FlashBagInterface $flashBag)\n    {\n        $this->entityManager = $entityManager;\n        $this->urlGenerator = $urlGenerator;\n        $this->csrfTokenManager = $csrfTokenManager;\n        $this->passwordEncoder = $passwordEncoder;\n        $this->flashBag = $flashBag;\n    }\n\n    public function supports(Request $request)\n    {\n        return self::LOGIN_ROUTE === $request->attributes->get('_route')\n            && $request->isMethod('POST');\n    }\n\n    public function getCredentials(Request $request)\n    {\n        $credentials = [\n\n            'email' => $request->request->get('email'),\n            'password' => $request->request->get('password'),\n            'csrf_token' => $request->request->get('_csrf_token'),\n        ];\n        $request->getSession()->set(\n            Security::LAST_USERNAME,\n            $credentials['email']\n        );\n\n        return $credentials;\n    }\n\n    public function getUser($credentials, UserProviderInterface $userProvider)\n    {\n        $token = new CsrfToken('authenticate', $credentials['csrf_token']);\n        if (!$this->csrfTokenManager->isTokenValid($token)) {\n            throw new InvalidCsrfTokenException();\n        }\n\n        $this->user = $this->entityManager->getRepository(User::class)->findOneBy(['email' => $credentials['email']]);\n\n        if (!$this->user) {\n            // fail authentication with a custom error\n            $this->flashBag->add('error', \"No se ha encontrado ningún usuario con ese correo electrónico.\");\n        }\n\n        return $this->user;\n    }\n\n    public function checkCredentials($credentials, UserInterface $user)\n    {\n        if (!$this->passwordEncoder->isPasswordValid($user, $credentials['password'])) {\n            $this->flashBag->add('error', \"La contraseña no es correcta\");\n        }\n        return $this->passwordEncoder->isPasswordValid($user, $credentials['password']);\n    }\n\n    /**\n     * Used to upgrade (rehash) the user's password automatically over time.\n     */\n    public function getPassword($credentials): ?string\n    {\n        return $credentials['password'];\n    }\n\n    public function onAuthenticationSuccess(Request $request, TokenInterface $token, $providerKey)\n    {\n\n        if ($this->isUserAnAdmin()) {\n            return new RedirectResponse($this->urlGenerator->generate(self::ADMIN_ROUTE));\n        }\n\n        $findGameSessionMilestoneService = new FindGameSessionMilestoneService($this->entityManager, $this->user, $this->urlGenerator);\n        return new RedirectResponse($findGameSessionMilestoneService->execute());\n\n    }\n\n    protected function getLoginUrl()\n    {\n        return $this->urlGenerator->generate(self::LOGIN_ROUTE);\n    }\n\n    private function isUserAnAdmin()\n    {\n        return in_array(\"ROLE_ADMIN\", $this->user->getRoles());\n\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/Security/LoginAuthenticator.php	(revision 529c319976558124ccd4221c7bb370bea6f69aac)
+++ src/Security/LoginAuthenticator.php	(date 1625217906654)
@@ -123,6 +123,5 @@
     private function isUserAnAdmin()
     {
         return in_array("ROLE_ADMIN", $this->user->getRoles());
-
     }
 }
Index: templates/base.html.twig
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    {% block head %}\n    <meta charset=\"UTF-8\">\n    <title>{% block title %}{% endblock %}</title>\n    {% block stylesheets %}\n        <!--Jquery,-->\n        <script\n                src=\"https://code.jquery.com/jquery-3.5.1.min.js\"\n                integrity=\"sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=\"\n                crossorigin=\"anonymous\">\n        </script>\n        {% if is_granted('IS_AUTHENTICATED_FULLY')%}\n        <script>\n            var API_DOMAIN = '{{ apiHost }}';\n        </script>\n        {% endif %}\n        <!-- Compiled and minified CSS -->\n        <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n        <!-- Compiled and minified JavaScript -->\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n        <!--Font Awesome -->\n        <link rel=\"stylesheet\" href=\"{{ asset('css/font-awesome.css') }}\">\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\">\n        <!-- Materialize icons -->\n        <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n\n        <!--CSS stylesheet-->\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"{{ asset('css/cookies.css') }}\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"{{ asset('css/base.css') }}\">\n\n    {% endblock %}\n</head>\n    {% endblock %}\n\n<body>\n\n<div class=\"base\">\n    <nav class=\"menu logged-user\">\n        <div class=\"nav-wrapper\">\n            {% if is_granted('IS_AUTHENTICATED_FULLY') %}\n                {% if app.user.profilePic %}\n                    {% if app.request.get('_route') == 'profile' %}\n                        <a href=\"{{ path('profile') }}\" class=\"avatar\"><img src=\"/resources/users/{{ app.user.username }}/{{ app.user.profilePic }}\" alt=\"\"></a>\n                        <ul class=\"right hide-on-med-and-down\">\n                            <li><a href=\"{{ path('app_login') }}\" class=\"waves-effect waves-light btn\"><i class=\"material-icons left\">arrow_back</i>Volver al juego</a></li>\n                            <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_logout') }}\">Salir</a></li>\n                        </ul>\n                    {% else %}\n                        <a href=\"{{ path('profile') }}\" class=\"avatar\"><img src=\"/resources/users/{{ app.user.username }}/{{ app.user.profilePic }}\" alt=\"\"></a>\n                        <ul class=\"right hide-on-med-and-down\">\n                            <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_logout') }}\">Salir</a></li>\n                        </ul>\n                    {% endif %}\n                {% else %}\n                    {% if app.request.get('_route') == 'profile' %}\n                        <a href=\"{{ path('profile') }}\" class=\"avatar\"><i  class=\"small material-icons default_avatar\">account_box</i></a>\n                        <ul class=\"right hide-on-med-and-down\">\n                            <li><a href=\"{{ path('app_login') }}\" class=\"waves-effect waves-light btn\"><i class=\"material-icons left\">arrow_back</i>Volver al juego</a></li>\n                            <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_logout') }}\">Salir</a></li>\n                        </ul>\n                    {% else %}\n                        <a href=\"{{ path('profile') }}\" class=\"avatar\"><i class=\"small material-icons default_avatar\">account_box</i></a>\n                        <ul class=\"right hide-on-med-and-down\">\n                            <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_logout') }}\">Salir</a></li>\n                        </ul>\n                    {% endif %}\n                {% endif %}\n\n            {% else %}\n                {% if app.request.get('_route') == 'register' %}\n                    <ul class=\"right hide-on-med-and-down\">\n                        <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_login') }}\">Iniciar Sesión</a></li>\n                    </ul>\n                {% elseif app.request.get('_route') == 'app_login' %}\n                    <ul class=\"right hide-on-med-and-down\">\n                        <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('register') }}\">Registrarse</a></li>\n                    </ul>\n                {% else %}\n                    <ul class=\"right hide-on-med-and-down\">\n                        <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('register') }}\">Registrarse</a></li>\n                        <li><a class=\"waves-effect waves-light btn\" href=\"{{ path('app_login') }}\">Iniciar Sesión</a></li>\n                    </ul>\n                {% endif %}\n\n            {% endif %}\n        </div>\n    </nav>\n</div>\n\n    {% for message in app.flashes('success') %}\n        <div class=\"flash-success\">\n            {{ message }}\n        </div>\n    {% endfor %}\n    {% for message in app.flashes('error') %}\n        <div class=\"flash-error\">\n            {{ message }}\n        </div>\n    {% endfor %}\n    {% for message in app.flashes('alert') %}\n        <div class=\"flash-alert\">\n            {{ message }}\n        </div>\n    {% endfor %}\n\n\n{% block body %}\n\n{% endblock %}\n\n\n{% block javascripts %}{% endblock %}\n\n</body>\n\n\n</html>\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- templates/base.html.twig	(revision 529c319976558124ccd4221c7bb370bea6f69aac)
+++ templates/base.html.twig	(date 1628693025180)
@@ -14,7 +14,7 @@
         </script>
         {% if is_granted('IS_AUTHENTICATED_FULLY')%}
         <script>
-            var API_DOMAIN = '{{ apiHost }}';
+           // var API_DOMAIN = '{{ apiHost }}';
         </script>
         {% endif %}
         <!-- Compiled and minified CSS -->
